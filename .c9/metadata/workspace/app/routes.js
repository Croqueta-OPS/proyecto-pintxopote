{"changed":true,"filter":false,"title":"routes.js","tooltip":"/app/routes.js","value":"module.exports = function(app, passport) {\n\n\tvar Pintxo = require('../app/models/pintxo');//modelo\n\tvar User = require('../app/models/user');//modelo\n\tvar Bar = require('../app/models/bar');//modelo\n\n\t// =====================================\n\t// HOME PAGE (with login links) ========\n\t// =====================================\n\tapp.get('/', function(req, res) {\n\t\tres.render('index.ejs'); // load the index.ejs file\n\t\t\n\t\t\t//User.find(function(err, user){\n\t\t\t\t//if (err) return console.error(err);\n\t\t\t\t//console.log(user[0].local.email);\n\t\t\t//});\n\t});\n\n\tapp.get('/pintxos', function (require, response) {\n\n\t \tPintxo.find(function(err, pintxos) {\n\t \t\t\n \t\t\tif (err) return console.error(err);\n  \t\t\tresponse.send(pintxos);\n  \t\t\t\n\t\t});\n\t\t\n\t});\n\t\n\tapp.get('/bares', function (require, response) {\n\t\t\n\t \tBar.find(function(err, bares) {\n\t \t\t\n \t\t\tif (err) return console.error(err);\n  \t\t\tresponse.send(bares);\n  \t\t\t\n\t\t});\n\t\t\n\t});\n\t\n\t// =====================================\n\t// LOGIN ===============================\n\t// =====================================\n\t// Muestra el formulario del login\n\tapp.get('/login', function(req, res) {\n\n\t\t// carga la página de inicio de sesión y muestra un mensaje en caso de error al registrarse\n\t\tres.render('login.ejs', { message: req.flash('loginMessage')}); \n\t});\n\n\t// =====================================\n\t// SIGNUP ==============================\n\t// =====================================\n\t// Muestra el formulario de registro\n\tapp.get('/signup', function(req, res) {\n\t\t// carga la página de registro y muestra un mensaje en caso de error al registrarse\n\t\tres.render('signup.ejs', { message: req.flash('signupMessage')});\n\t});\n\n\t// =====================================\n\t// PROFILE SECTION =====================\n\t// =====================================\n\t// we will want this protected so you have to be logged in to visit\n\t// we will use route middleware to verify this (the isLoggedIn function)\n\tapp.get('/profile', isLoggedIn, function(req, res) {\n\t\t\n\t\t//User.find(function(err, user){\n\t\t//\tif (err) return console.error(err);\n\t\t\n\t//\t});\n\t\tconsole.log(req.user.local.administrador);\n\t\n\t\tif (req.user.local.administrador.localeCompare('1')){\n\t\t\tconsole.log(\"Es administrador\");\n\t\t}\n\t\telse{\n\t\t\tconsole.log(\"No es administrador\");\n\t\t}\n\t\t\n\t\tres.render('profile.ejs', {\n\t\t\tuser : req.user // get the user out of session and pass to template\n\t\t});\n\t\t\n\n\t});\n\n\t// =====================================\n\t// LOGOUT ==============================\n\t// =====================================\n\tapp.get('/logout', function(req, res) {\n\t\treq.logout();\n\t\tres.redirect('/');\n\t});\n\n\t// procesamos el formulario de registro\n\tapp.post('/signup', passport.authenticate('local-signup', {\n\t\tsuccessRedirect : '/profile', // redirect to the secure profile section\n\t\tfailureRedirect : '/signup', // redirect back to the signup page if there is an error\n\t\tfailureFlash : true // allow flash messages\n\t}));\n\n\t// procesamos el formulario login\n\tapp.post('/login', passport.authenticate('local-login', {\n\t\tsuccessRedirect : '/profile', // redirect to the secure profile section\n\t\tfailureRedirect : '/login', // redirect back to the signup page if there is an error\n\t\tfailureFlash : true // allow flash messages\n\t}));\n};\n\n// route middleware to make sure a user is logged in\nfunction isLoggedIn(req, res, next) {\n\n\t// if user is authenticated in the session, carry on \n\tif (req.isAuthenticated())\n\t\treturn next();\n\n\t// if they aren't redirect them to the home page\n\tres.redirect('/');\n}\n","undoManager":{"mark":23,"position":39,"stack":[[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":29,"column":4},"end":{"row":29,"column":5}},"text":"*"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":29,"column":3},"end":{"row":29,"column":4}},"text":"/"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":33,"column":6},"end":{"row":33,"column":7}},"text":"/"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":33,"column":5},"end":{"row":33,"column":6}},"text":"*"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":30,"column":4},"end":{"row":30,"column":24}},"text":"\t\tconsole.log(\"kk\");"},{"action":"insertText","range":{"start":{"row":30,"column":24},"end":{"row":31,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":30,"column":18},"end":{"row":30,"column":22}},"text":"\"kk\""},{"action":"insertText","range":{"start":{"row":30,"column":18},"end":{"row":30,"column":19}},"text":"b"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":30,"column":19},"end":{"row":30,"column":20}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":30,"column":20},"end":{"row":30,"column":21}},"text":"r"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":30,"column":21},"end":{"row":30,"column":22}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":30,"column":22},"end":{"row":30,"column":23}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":32,"column":39},"end":{"row":33,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":33,"column":0},"end":{"row":33,"column":4}},"text":" \t\t\t"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":31,"column":0},"end":{"row":31,"column":18}},"text":"console.log(\"kk\");"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":31,"column":15},"end":{"row":31,"column":16}},"text":"a"},{"action":"insertText","range":{"start":{"row":31,"column":16},"end":{"row":31,"column":17}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":31,"column":17},"end":{"row":31,"column":18}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":31,"column":18},"end":{"row":31,"column":19}},"text":"d"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":21,"column":39},"end":{"row":22,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":22,"column":0},"end":{"row":22,"column":4}},"text":" \t\t\t"},{"action":"insertText","range":{"start":{"row":22,"column":4},"end":{"row":22,"column":7}},"text":"con"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":22,"column":7},"end":{"row":22,"column":9}},"text":"sl"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":22,"column":8},"end":{"row":22,"column":9}},"text":"l"},{"action":"insertText","range":{"start":{"row":22,"column":8},"end":{"row":22,"column":9}},"text":"o"},{"action":"insertText","range":{"start":{"row":22,"column":9},"end":{"row":22,"column":11}},"text":"le"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":22,"column":11},"end":{"row":22,"column":12}},"text":"."}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":22,"column":12},"end":{"row":22,"column":15}},"text":"log"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":22,"column":15},"end":{"row":22,"column":17}},"text":"()"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":22,"column":16},"end":{"row":22,"column":20}},"text":"pint"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":22,"column":20},"end":{"row":22,"column":23}},"text":"xos"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":22,"column":24},"end":{"row":22,"column":25}},"text":";"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":32,"column":0},"end":{"row":32,"column":1}},"text":"\t"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":32,"column":1},"end":{"row":32,"column":2}},"text":"\t"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":32,"column":2},"end":{"row":32,"column":3}},"text":"\t"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":32,"column":3},"end":{"row":32,"column":4}},"text":"\t"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":32,"column":4},"end":{"row":32,"column":5}},"text":"\t"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":32,"column":5},"end":{"row":32,"column":6}},"text":"\t"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":32,"column":0},"end":{"row":32,"column":28}},"text":"\t\t\t\t\t\tconsole.log(\"kkasad\");"},{"action":"removeText","range":{"start":{"row":31,"column":6},"end":{"row":31,"column":25}},"text":"console.log(bares);"},{"action":"removeText","range":{"start":{"row":31,"column":6},"end":{"row":32,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":31,"column":0},"end":{"row":31,"column":6}},"text":"\t \t\t\t\t"},{"action":"removeText","range":{"start":{"row":30,"column":34},"end":{"row":31,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":32,"column":0},"end":{"row":32,"column":4}},"text":" \t\t\t"},{"action":"removeText","range":{"start":{"row":31,"column":39},"end":{"row":32,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":20,"column":39},"end":{"row":21,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":21,"column":0},"end":{"row":21,"column":4}},"text":"\t \t\t"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":24,"column":28},"end":{"row":25,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":25,"column":0},"end":{"row":25,"column":5}},"text":"  \t\t\t"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":32,"column":34},"end":{"row":33,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":33,"column":0},"end":{"row":33,"column":4}},"text":"\t \t\t"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":35,"column":26},"end":{"row":36,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":36,"column":0},"end":{"row":36,"column":5}},"text":"  \t\t\t"}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":23,"column":0},"end":{"row":24,"column":0}},"nl":"\n","lines":[" \t\t\tconsole.log(pintxos);"]}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":30,"column":0},"end":{"row":31,"column":0}},"nl":"\n","lines":["\t\tconsole.log(\"kk\");"]}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":29,"column":49},"end":{"row":30,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":30,"column":0},"end":{"row":30,"column":2}},"text":"\t\t"}]}]]},"ace":{"folds":[],"customSyntax":"javascript","scrolltop":195,"scrollleft":0,"selection":{"start":{"row":26,"column":2},"end":{"row":26,"column":2},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":12,"state":"start","mode":"ace/mode/javascript"}},"timestamp":1415185356833}