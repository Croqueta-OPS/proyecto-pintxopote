{"changed":true,"filter":false,"title":"votaciones.js","tooltip":"/public/js/votaciones.js","value":"$(window).load(function() {\n    \n    var logueado = $('#btnUsuario').attr('class');\n            \n            if(logueado=='visible'){\n                \n                $( \".ratings_stars\" ).click(function() {\n                    \n                    var ident = $(this).attr(\"id\").substring(0, $(this).attr(\"id\").length - 1);//guardamos el ID del pintxo en la variable\n                    var puntos = $(this).attr(\"value\");//guardamos el valor del voto\n                    \n                    var cantPuntos = $(this).siblings(\".votos\").children(\"div.total_puntos\").attr(\"value\");//guardamos los puntos totales que tiene ese pintxo\n                    var votos = $(this).siblings(\".votos\").children(\"div.total_votes\").attr(\"value\");//guardamos el total de los votos\n                    var media = $(this).siblings(\".votos\").children(\"div.media_votes\").attr(\"value\");//guardamos la media\n                    \n                    \n                    puntos = parseInt(puntos);\n                    votos = parseInt(votos);\n                    media = parseInt(media);\n                    nuevosPuntos = parseInt(nuevosPuntos);\n                    cantPuntos = parseInt(cantPuntos);\n                    \n                    var nuevosPuntos = parseInt(cantPuntos + puntos);//obtenemos los nuevos puntos\n                    var nuevosVotos = parseInt(votos+1);//obtebemos la nueva cantidad de votos\n                    var nuevaMedia = parseInt(nuevosPuntos/nuevosVotos);//obtenemos la nueva media\n                    \n                    //alert(\"nuevos votos:\"+nuevosVotos+\", nuevos puntos:\"+nuevosPuntos+\", nueva media:\"+nuevaMedia);\n                    \n                    var arrayVotados = [];\n                    \n                    var votado = false;\n                    \n                \t$.ajax({\n\t\n                \t\ttype: \"GET\",\t//Indicamos que se trata de una petición GET\n                \t\turl: \"/usuarios\",\t//Accediendo a pintxos\n                \t\tdataType: \"json\",\t//El tipo objeto que se espera recibir, en este caso json, un array de pintxos\n                \t\t\n                \t\t//Si la petición es correcta, se ejecutará el script de carga de datos\n                \t\tsuccess: function(data) {\n                \t\t    \n        \t\t            data.forEach(function(element, index, array) {\t\n        \t\t                \n                                if (element.local.nomUsuario == document.getElementById(\"nomUsuario\").innerHTML) {\n                                    element.local.pintxosVotados.forEach(function(ele, index, array) {\n                                        \n                                        arrayVotados.push(ele);\n                                        \n                                    });\n                                }\n                \t\t        \n        \t\t            });\n                \t\t    \n                \t\t    \n                \t\t    \n                \t\t    arrayVotados.forEach(function(element, index, array) {\n                \t\t        \n                \t\t        if (element == ident) {\n                \t\t            votado = true;\n                \t\t        }\n                \t\t        \n                \t\t    });\n                \t\t    \n                \t\t    if (votado) {\n                \t    \n                        \t    alert(\"Ya has votado ese pintxo!\");\n                        \t    \n                        \t}\n                        \t\n                        \telse {\n                        \t    if(puntos == 1){\n                        \n                                    alert(\"¡Le has dado 1 punto!\");\n                                    \n                                }else{\n                                    \n                                    alert(\"¡Le has dado \"+puntos+\" puntos!\");\n                                    \n                                }\n                         \n                                $.post( \"/emiteVoto\", {\n                                    id: ident,\n                                    punt: nuevosPuntos,\n                                    votes: nuevosVotos,\n                                    med: nuevaMedia\n                                });\n                            \n                        \t}\n                        \t\t    \n                \t\t}\n                        \t\t\n                \t});\n                    \n                });                 \n            }else{\n                $( \".ratings_stars\" ).click(function() {\n\n                    alert('¡No puedes votar si no estás registrado!');\n                });\n            }\n    \n\n      $('.ratings_stars').hover(\n            // Handles the mouseover\n            function() {\n                $(this).prevAll().andSelf().addClass('ratings_over');\n                $(this).nextAll().removeClass('ratings_vote');\n                $(this).nextAll().removeClass('ratings_over');\n            },\n            // Handles the mouseout \n            function() {\n                $(this).prevAll().andSelf().removeClass('ratings_over');\n                $(this).nextAll().andSelf().removeClass('ratings_vote');\n                estrellasMedia();\n                /*set_votes($(this).parent());*/\n            }\n        );\n});","undoManager":{"mark":4,"position":7,"stack":[[{"group":"doc","deltas":[{"start":{"row":94,"column":16},"end":{"row":112,"column":20},"action":"remove","lines":["\t// location.reload();","                    /*//función que usamos para recargar la página","                    location.reload(function (){","                    $(window).load(function() {","","                        $('.ratings_stars').hover(","                        // Handles the mouseover","                        function() {","                            $(this).prevAll().andSelf().addClass('ratings_over');","                            $(this).nextAll().removeClass('ratings_vote'); ","                        },","                        // Handles the mouseout ","                        function() {","                            $(this).prevAll().andSelf().removeClass('ratings_over');","                        }","                        );","                    });","                    });*/","                    "]}]}],[{"group":"doc","deltas":[{"start":{"row":94,"column":16},"end":{"row":112,"column":20},"action":"insert","lines":["\t// location.reload();","                    /*//función que usamos para recargar la página","                    location.reload(function (){","                    $(window).load(function() {","","                        $('.ratings_stars').hover(","                        // Handles the mouseover","                        function() {","                            $(this).prevAll().andSelf().addClass('ratings_over');","                            $(this).nextAll().removeClass('ratings_vote'); ","                        },","                        // Handles the mouseout ","                        function() {","                            $(this).prevAll().andSelf().removeClass('ratings_over');","                        }","                        );","                    });","                    });*/","                    "]}]}],[{"group":"doc","deltas":[{"start":{"row":94,"column":16},"end":{"row":112,"column":20},"action":"remove","lines":["\t// location.reload();","                    /*//función que usamos para recargar la página","                    location.reload(function (){","                    $(window).load(function() {","","                        $('.ratings_stars').hover(","                        // Handles the mouseover","                        function() {","                            $(this).prevAll().andSelf().addClass('ratings_over');","                            $(this).nextAll().removeClass('ratings_vote'); ","                        },","                        // Handles the mouseout ","                        function() {","                            $(this).prevAll().andSelf().removeClass('ratings_over');","                        }","                        );","                    });","                    });*/","                    "]}]}],[{"group":"doc","deltas":[{"start":{"row":92,"column":20},"end":{"row":93,"column":25},"action":"remove","lines":["","                        \t"]}]}],[{"group":"doc","deltas":[{"start":{"row":92,"column":20},"end":{"row":93,"column":16},"action":"remove","lines":["","                "]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":36},"end":{"row":5,"column":0},"action":"insert","lines":["",""]},{"start":{"row":5,"column":0},"end":{"row":5,"column":16},"action":"insert","lines":["                "]}]}],[{"group":"doc","deltas":[{"start":{"row":16,"column":0},"end":{"row":17,"column":20},"action":"remove","lines":["                    /*alert(ident+\" valoracion:\"+puntos+\" votos:\"+votos+\" media:\"+media);*/","                    "]}]}],[{"group":"doc","deltas":[{"start":{"row":15,"column":20},"end":{"row":16,"column":0},"action":"remove","lines":["",""]}]}]]},"ace":{"folds":[],"scrolltop":1539.5,"scrollleft":0,"selection":{"start":{"row":81,"column":40},"end":{"row":81,"column":45},"isBackwards":true},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":23,"state":"start","mode":"ace/mode/javascript"}},"timestamp":1423833985000}